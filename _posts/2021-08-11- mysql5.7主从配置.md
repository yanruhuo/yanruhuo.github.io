---
title: pgsql10.5主从配置
tags:
  - 软件安装配置
jekyll-theme-WuK:
  background_music: '<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=27876158&auto=0&height=66"></iframe>'
---
1.主库修改MySQL配置
```p
vim /etc/my.cnf
在[mysqld]中添加：

#主数据库端ID号
server_id = 1           
 #有趣的音符                  
日志-bin = mysql-bin    
#需要复制的数据库名，如果复制多个数据库，重复设置这个选项菌                  
binlog-do-db = db        
#要从服务器从主服务器收到的更新记录到从服务器自己的日志文件中                 
日志从站更新                        
#控制binlog的写入。每执行多少次事务写一次（这个参数性能消耗很大，但可知道MySQL崩溃导致的损失） 
同步二进制日志 = 1                    
#一般用在主同步中，避免错过自增值这个关键值冲突
auto_increment_offset = 1           
#一般用在主同步中，避免错过自增值这个关键值冲突
auto_increment_increment = 1            
#二进制日志自动删除的天数，默认值为0，表示“没有自动删除”，启动时和双日志循环时可能删除  
expire_logs_days = 7                    
#将函数复制到从机  
log_bin_trust_function_creators = 1 

#添加完成后重启数据库

```

2.主库创建允许从同步服务器数据的账户
```p
mysql -u 根 -p

将*.*上的复制slave授予'主从用户名'@'%'，由'密码'标识；#主从备份用户

#更新数据库权限
刷新权限；

#重启数据库
```

3.主库查询mysql状态
```p
显示主状态\G;
mysql> 显示主状态；
+-----------------+----------+--------------+---- --------------+--------------------+
| 档案 | 职位 | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+-----------------+----------+--------------+---- --------------+--------------------+
| mysql-bin.000003 | 154 | 数据库 | | |
+-----------------+----------+--------------+---- --------------+--------------------+
1 行（0.00 秒）
# mysql-bin.000003和154记录下来
```

4.从库修改mysql配置
```p
vim /etc/my.cnf
在[mysqld]中添加

server_id = 2
日志-bin = mysql-bin
日志从站更新
同步二进制日志 = 0
#log buffer将一次地写入日志文件中，日志文件的flush（刷到磁盘）操作同时进行。模式下在事务提交的时候，不会主动触发写入磁盘的操作
innodb_flush_log_at_trx_commit = 0        
#指定从机要复制哪个库
复制-做-db = db         
#MySQL 主从复制的，当Master和Slave之间的网络中断，但是Master和Slave无法发现的情况下（例如防火墙或者会等待语音问题）。Slave_timeout的设置秒数后，才能认为网络出现故障，然后会重连并且追赶最近时间主库的数据
从属网络超时 = 60                    
log_bin_trust_function_creators = 1

#重启从库服务器。
```

5.从库执行同步命令
```p
#执行同步命令，设置主服务器ip，同步账号密码，同步位置
 把master改成master_host='10.95.130.23',master_user='主从用户名',master_password='密码',master_log_file='mysql-bin.000003',master_log_pos=154;
 
 #开启同步功能
 启动奴隶；
```

6.查看从库状态
```p
显示从机状态\G;

	Slave_IO_Running: 是
	Slave_SQL_Running: 是
#Slave_IORunning及Slave_SQL_Running进程必须正常运行，即是状态，否则说明同步失败。
```
